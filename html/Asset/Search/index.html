<%init>
my $catalog_obj = LoadDefaultCatalog($ARGS{'Catalog'} || '');
$ARGS{'Catalog'} = $catalog_obj->Id;

my $assets = RT::Assets->new($session{CurrentUser});
my %search = ProcessAssetsSearchArguments(
    Assets => $assets, Catalog => $catalog_obj, ARGSRef => \%ARGS,
);

</%init>
<& /Elements/Header, Title => loc("Assets") &>
<& /Elements/Tabs &>

% if ( $ARGS{'SearchAssets'} or $ARGS{q} ){
<& /Elements/CollectionList,
    %search,
    Collection      => $assets,
    AllowSorting    => 1,
    &>
%   if (not $assets->Count) {
<em><&|/l&>No assets matching search criteria found.</&></em>
%   }
% }
<form action="<% RT->Config->Get('WebPath') %>/Asset/Search/index.html" id="AssetSearch">
<&| /Widgets/TitleBox, title => "Search Assets" &>
<& /Asset/Elements/AssetSearchBasics, %ARGS, CatalogObj => $catalog_obj &>
% foreach my $group ( RT::CustomField->CustomGroupings( "RT::Asset" ), '' ) {
    <& /Asset/Elements/AssetSearchCFs, %ARGS, Grouping => $group,
       CatalogObj => $catalog_obj &>
% }
<& /Elements/Submit, Label => loc('Search'), Name => 'SearchAssets' &>
</&>

<script>
jQuery(function() {
    var all_inputs = jQuery("#AssetSearch input, #AssetSearch select");
    all_inputs.each(function() {
        var elem = jQuery(this);
        var update_elems = all_inputs.filter(function () {
            return jQuery(this).attr("name") == elem.attr("name");
        }).not(elem);
        if (update_elems.length == 0)
            return;
        var trigger_func = function() { update_elems.val(elem.val()) };
        if (elem.attr("type") == "text")
            elem.keyup( trigger_func );
        else
            elem.change( trigger_func );
    });
});
</script>
</form>
